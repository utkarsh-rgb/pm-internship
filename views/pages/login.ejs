<div class="container py-3 py-md-5">
  <div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-success text-white text-center py-2 py-md-3">
          <h3 class="login-title fw-bold mb-0">Login</h3>
        </div>
        <div class="card-body p-3 p-md-4">
          <form id="loginForm">
            <!-- Email -->
            <div class="mb-2 mb-md-3">
              <label for="loginEmail" class="form-label fw-semibold login-label">Email</label>
              <input 
                type="email" 
                class="form-control login-input" 
                id="loginEmail" 
                name="email" 
                placeholder="Enter your email"
                required>
            </div>
            
            <!-- Password -->
            <div class="mb-3 mb-md-4">
              <label for="loginPassword" class="form-label fw-semibold login-label">Password</label>
              <div class="position-relative">
                <input 
                  type="password" 
                  class="form-control login-input" 
                  id="loginPassword" 
                  name="password" 
                  placeholder="Enter your password"
                  required>
                <button 
                  type="button" 
                  class="btn btn-link position-absolute top-50 end-0 translate-middle-y me-2 p-1 toggle-password"
                  tabindex="-1">
                  <i class="bi bi-eye-slash" id="toggleIcon"></i>
                </button>
              </div>
            </div>
            
            <button type="submit" class="btn btn-success w-100 fw-semibold login-btn mb-2 mb-md-3">
              <span class="login-btn-text">Login</span>
              <div class="spinner-border spinner-border-sm ms-2 d-none" role="status" id="loginSpinner">
                <span class="visually-hidden">Loading...</span>
              </div>
            </button>
          </form>
          
          <div class="text-center">
            <p class="login-footer-text mb-2">
              Don't have an account? <a href="/signup" class="text-success fw-semibold">Sign Up</a>
            </p>
            <p class="login-footer-text mb-0">
              <a href="/forgot-password" class="text-muted small">Forgot Password?</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Login form responsive styles */
.login-title {
  font-size: 1.2rem;
}

.login-label {
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.login-input {
  font-size: 0.85rem;
  padding: 0.5rem 0.75rem;
  border-radius: 0.375rem;
  border: 1px solid #ced4da;
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.login-input:focus {
  border-color: #198754;
  box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
}

.login-btn {
  font-size: 0.9rem;
  padding: 0.6rem;
  border-radius: 0.375rem;
  transition: all 0.2s ease;
}

.login-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.login-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.login-footer-text {
  font-size: 0.85rem;
}

.toggle-password {
  border: none !important;
  background: none !important;
  color: #6c757d;
  font-size: 0.9rem;
  padding: 0 !important;
  width: auto !important;
  height: auto !important;
}

.toggle-password:hover {
  color: #198754;
}

.toggle-password:focus {
  box-shadow: none !important;
}

/* Mobile specific styles */
@media (max-width: 576px) {
  .login-title {
    font-size: 1.1rem;
  }
  
  .login-label {
    font-size: 0.8rem;
  }
  
  .login-input {
    font-size: 0.8rem;
    padding: 0.45rem 0.65rem;
  }
  
  .login-btn {
    font-size: 0.85rem;
    padding: 0.55rem;
  }
  
  .login-footer-text {
    font-size: 0.8rem;
  }
  
  .card-body {
    padding: 1rem !important;
  }
  
  .card-header {
    padding: 0.75rem !important;
  }
  
  .toggle-password {
    font-size: 0.85rem;
  }
  
  /* Reduce margins on mobile */
  .mb-2 {
    margin-bottom: 0.75rem !important;
  }
  
  .mb-3 {
    margin-bottom: 1rem !important;
  }
}

/* Extra small devices */
@media (max-width: 400px) {
  .login-title {
    font-size: 1rem;
  }
  
  .login-label {
    font-size: 0.75rem;
  }
  
  .login-input {
    font-size: 0.75rem;
    padding: 0.4rem 0.6rem;
  }
  
  .login-btn {
    font-size: 0.8rem;
    padding: 0.5rem;
  }
  
  .login-footer-text {
    font-size: 0.75rem;
  }
  
  .container {
    padding-left: 10px;
    padding-right: 10px;
  }
}

/* Medium screens and up */
@media (min-width: 768px) {
  .login-title {
    font-size: 1.5rem;
  }
  
  .login-label {
    font-size: 0.95rem;
    margin-bottom: 0.5rem;
  }
  
  .login-input {
    font-size: 0.95rem;
    padding: 0.65rem 0.85rem;
  }
  
  .login-btn {
    font-size: 1rem;
    padding: 0.75rem;
  }
  
  .login-footer-text {
    font-size: 0.95rem;
  }
}

/* Loading state */
.login-btn.loading .login-btn-text {
  opacity: 0.7;
}

/* Form validation styles */
.login-input.is-invalid {
  border-color: #dc3545;
}

.login-input.is-valid {
  border-color: #198754;
}

/* Animation for better UX */
.card {
  animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Focus improvements for accessibility */
.login-input:focus,
.login-btn:focus,
a:focus {
  outline: 2px solid #198754;
  outline-offset: 2px;
}
</style>

<script>
const loginForm = document.getElementById("loginForm");
const loginBtn = document.querySelector(".login-btn");
const loginSpinner = document.getElementById("loginSpinner");
const togglePasswordBtn = document.querySelector(".toggle-password");
const passwordInput = document.getElementById("loginPassword");
const toggleIcon = document.getElementById("toggleIcon");

// Password visibility toggle
togglePasswordBtn.addEventListener("click", () => {
  const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
  passwordInput.setAttribute("type", type);
  
  if (type === "text") {
    toggleIcon.className = "bi bi-eye";
  } else {
    toggleIcon.className = "bi bi-eye-slash";
  }
});

// Enhanced form validation
function validateForm(data) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  
  if (!data.email || !emailRegex.test(data.email)) {
    return { valid: false, message: "Please enter a valid email address" };
  }
  
  if (!data.password || data.password.length < 6) {
    return { valid: false, message: "Password must be at least 6 characters long" };
  }
  
  return { valid: true };
}

// Enhanced login form handler
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const data = {
    email: document.getElementById("loginEmail").value.trim(),
    password: document.getElementById("loginPassword").value
  };
  
  // Client-side validation
  const validation = validateForm(data);
  if (!validation.valid) {
    alert("⚠️ " + validation.message);
    return;
  }
  
  // Show loading state
  loginBtn.disabled = true;
  loginBtn.classList.add("loading");
  loginSpinner.classList.remove("d-none");
  
  try {
    const res = await fetch("http://localhost:3000/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    
    const result = await res.json();
    
    if (result.success && result.studentId) {
      // Save login info in localStorage
      localStorage.setItem("studentId", result.studentId);
      localStorage.setItem("studentName", result.studentName);
      
      alert("✅ Login successful!");
      window.location.href = "/"; // redirect home
    } else {
      alert("⚠️ " + (result.message || "Login failed. Please try again."));
    }
  } catch (err) {
    console.error("Login error:", err);
    alert("❌ Network error. Please check your connection and try again.");
  } finally {
    // Reset loading state
    loginBtn.disabled = false;
    loginBtn.classList.remove("loading");
    loginSpinner.classList.add("d-none");
  }
});

// Auto-focus first input on page load
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("loginEmail").focus();
});

// Enhanced keyboard navigation
loginForm.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && e.target.type !== "submit") {
    e.preventDefault();
    const formElements = Array.from(loginForm.querySelectorAll("input, button"));
    const currentIndex = formElements.indexOf(e.target);
    const nextElement = formElements[currentIndex + 1];
    
    if (nextElement) {
      nextElement.focus();
    }
  }
});
</script>